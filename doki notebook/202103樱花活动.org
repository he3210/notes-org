+TITLE: 202103樱花活动

** 开发内容
*** 一起去赏樱
**** 无色樱花瓣
- 五色樱花瓣界面接口/兑换五色花瓣接口
**** 无色樱合成
- 无色樱合成界面接口/合成接口
- 用户在本直播间的合成历史接口
**** 赏樱
***** 用户端（1 个 tab：赏樱）
- 赏樱界面接口
***** 主播端（2 个 tab：无色樱、赏樱）
- 赏樱 tab 界面接口/主播解锁赏樱接口
  + 解锁赏樱时，使用队列，先解锁的先生效
  + 解锁后，有 buff 奖励，需要修改加分模块
- 无色樱 tab 界面：该直播间所有用户合成记录
*** 樱花名人
**** 主界面接口
- 花见名人堂
- 未开启阶段/充能阶段/夺宝阶段
**** 名人奖励接口
- 可以领取吗？旗子达到指定数量自动下发

*** 加分模块
**** 一起去赏樱
- 本直播间每贡献 200pt，加 1 无色樱抽奖机会
**** 樱花名人
- 记录本轮夺宝名人历史。使可以统计出上一轮夺宝，名人最多的主播；根据人数确定奖池 gold 上限；本轮夺宝人数；发起者本轮第一个名人
- 记录充能，充能满后，开启夺宝事件
- 抢夺成功后的花瓣收集加倍问题？
- 充能下一天是否能继续？能
- 每一轮首个成功参与夺宝的直播间将会掉落福袋。福袋上会显示该福袋的开启者？
**** 榜单
- 赏樱期间，榜单加成。解锁赏樱时，使用队列，先解锁的先生效

*** 夺宝事件
**** 当前事件
***** 设置当前事件
- hash key = pre + day_index + type
- field: value
#+BEGIN_SRC js
  {
      "task_id": 123,
      "pre_task_id": 122,   # 上一个任务id，0 代表不存在上一个任务
      "type": 0,            # 0-五本樱夺宝事件 1-十本樱夺宝事件 2-百本樱夺宝事件
      "cur_v": 100,         # 当前充能值
      "max_v": 3000,        # 最大充能值
      "start": 1616076000,  # 夺宝开始时间
      "end": 1616076900,    # 夺宝结束时间
      "opener": "u3684831580894394120001295",  # 第一个名人
      "winner": "u3684831580894394120001295",  # 最后一个名人
  }
#+END_SRC
**** 结束事件
***** 事件
#+BEGIN_SRC js
  {
      "task_id": 123
  }
#+END_SRC

***** 发起
- 充能完成后，发出一个 15min 后的结束事件
***** 处理
- 设置任务结束
- 设置本轮最后一个名人为夺宝成功者，并下发福袋
- 设置夺宝成功者所在直播间花瓣收集翻倍

*** icon 定时同步（五本樱、十本樱、百本樱）
**** 未开启阶段
- 充能礼物图
- 充能 0 进度，例如 0/3000
- 本阶段名人、樱姬头像为空
- 文案：09:00～次日02:00 开启

**** 充能阶段
- 充能礼物图
- 充能进度
- 本阶段名人、樱姬头像为空
- 文案：充能完毕开启花见夺宝

**** 夺宝阶段
- 充能礼物图
- 礼物价值
- 夺宝人数
- 夺宝倒计时
- 本阶段名人、樱姬头像
- 3 种状态文案：本轮没有名人时；有名人时；送礼人数达到要求时

**** 其它数据：赏樱中
- 赏樱地点
- 奖励：1.2倍pt
- 赏樱倒计时


*** 数据结构
**** reids 记录用户一轮夺宝累计送出数量
- hash key: pre + task_id + uid
- field: gift_id1/gift_id2/gift_id3
- value: 收礼数量
**** redis 记录本轮夺宝总人数
- hash key: pre
- field: task_id
- value: 夺宝总人数
**** redis 记录一轮
**** mysql 记录名人历史
- task_id
- type
- uid
- t_uid
- ctime
